<!--main/templates/detail.html-->
{% extends 'base.html' %}
{% load static %}
{% load bootstrap4 %}
{% block content %}


<!--공구 참여 버튼-->
<hr>
<div >공구 참여자 수 : {{ post.members.count }}/{{ post.limit }}</div>



<!--로그인이 되어있고, 글쓴이를 제외한 유저들에게만 보이게 함-->
{% if user.is_authenticated and user.profile != post.author %}
<a href="{% url 'post_participated_toggle' post.pk %}" class="btn btn-outline-success mr-5">
    {% if user.profile in post.members.all %}
        취소
    {% elif post.members.count >= post.limit%}
        모집 완료
    {% else %}
        공구 참여하기
    {% endif %}
</a><br>
{% endif %}



<hr>
<a href="{% url 'home' 'All' %}">HOME</a><br>
<a href="{% url 'edit' pk=post.pk %}">EDIT</a><br>
<a href="{% url 'delete' pk=post.pk %}">DELETE</a>

<!-- /////////////////////// -->
<head>
    <title>Detail</title>
    
    <link rel="stylesheet" href="{% static 'main/css/detail.css' %}">
</head>
<main>
    <section class="boxtop">
        <b>{{ post.title }}</b>
        <div class="writer">
            <img src='./iconmonstr-user-6-240.png' alt="myprofile" width=30px, height=30px>
            {{post.author}}
        </div>
    </section>
    <hr align="center" width="80%" size="5" color="green" noshade />
    <form>
        <section class="inputs">
            <div class="name_input">
                <div class="input" type="text" readonly id="location" name="location">{{ post.category }}</div>
            </div>
            <div class="name_input">
                <label for="link">링크</label>
                <div class="input" type="text" readonly id="link" name="link">{{post.link}}</div>
            </div>
            <div class="name_input">
                <label for="item">품목</label>
                <div class="input" type="text" readonly id="item" name="item">{{ post.item }}</div>
            </div>

            <div class="name_input">
                <label for="people">정원</label>
                <div class="input" type="text" readonly id="people" name="people">{{ post.limit }}</div>
            </div>
            <div class="name_input">
                <div class="dead">
                    <label for="deadline">마감기한</label>
                    <div class="input" type="datetime-local" id="deadline" name="deadline">{{ post.deadline }}</div>
                </div>
            </div>
        </section>
        <div class="input" type="text" readonly id="bodytext" name="bodytext" placeholder="본문 내용">{{ post.body }}</div>
        <p></p>
        <!-- 이미지는 일단...뺍시다... -->
<!-- {% if post.image %}
    <img src="{{ post.image.url }}"><br>
{% endif %} -->
        
        <section class="member">
            <div class="idimg">
                <p>
                    {% for member in post.members.all %}
                    <div class = "memimg">
                        <img src='{{member.my_image}}' alt="myprofile" width=40px, height=40px>
                    </div>
                        <p>{{member}}</p>
                        {% if post.author == member %}
                            <p class="writtenby">작성자</p>
                        {% endif %}
                    {% endfor %}
                </p>
                
            </div>
            <!-- 여기서부터 -->
            
        </section>
        <section class="btmbox">
            
            {% if user.profile in post.members.all %}
                <a href="{% url 'chat:room' room_number=post.pk %}" class="chatin">채팅방 입장</a><br><br>
            {% else %}
                <button class="chatin">참가하기!</button>
            {% endif %}


        </section>
    </form>
</main>
{% endblock %}